<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hồ cá ảo — Aquarium</title>
  <style>
    :root{
      --bg1:#04213a;
      --bg2:#02658b;
      --sand:#caa974;
      --seaweed:#125a3b;
      --bubble-color: rgba(255,255,255,0.35);
    }
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .aquarium{
      position:relative;overflow:hidden;width:100%;height:100vh;background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 60%);
      display:flex;align-items:flex-end;justify-content:center;
    }

    /* sandy bottom */
    .sand{
      position:absolute;left:0;right:0;bottom:0;height:14vh;background:radial-gradient(circle at 50% 0,#f2dea6 0%, #e0c78a 40%, #caa974 100%);
      box-shadow:0 -12px 40px rgba(0,0,0,0.25) inset;
      z-index:5;
    }

    /* seaweed */
    .seaweed{position:absolute;bottom:12vh;width:40px;height:40vh;left:6%;z-index:6}
    .seaweed .w{position:absolute;bottom:0;width:100%;height:100%;background:linear-gradient(180deg,var(--seaweed),#0a3b2b);border-radius:50px;transform-origin:bottom center;animation: sway 3s ease-in-out infinite}
    .seaweed.s2{left:18%;height:34vh;animation-delay:-0.4s}
    .seaweed.s3{left:86%;height:30vh;animation-delay:-0.8s}
    @keyframes sway{0%{transform:rotate(-6deg)}50%{transform:rotate(6deg)}100%{transform:rotate(-6deg)}}

    /* bubbles */
    .bubble{position:absolute;border-radius:50%;background:var(--bubble-color);opacity:0.9;box-shadow:0 2px 8px rgba(255,255,255,0.05) inset}

    /* fish base style */
    .fish{position:absolute;top:50%;left:-10%;transform:translateY(-50%);will-change:transform;pointer-events:none;z-index:10}
    .fish svg{display:block;width:120px;height:auto;filter:drop-shadow(0 6px 8px rgba(0,0,0,0.25))}

    /* swim animations: horizontal across the tank */
    @keyframes swimRight{
      0%{transform:translate3d(-20vw, var(--y,0), 0) scaleX(var(--flip,-1))}
      100%{transform:translate3d(120vw, var(--y,0), 0) scaleX(var(--flip,-1))}
    }
    @keyframes swimLeft{
      0%{transform:translate3d(120vw, var(--y,0), 0) scaleX(var(--flip,1))}
      100%{transform:translate3d(-20vw, var(--y,0), 0) scaleX(var(--flip,1))}
    }

    /* gentle vertical bob */
    .bob{animation:bob 3s ease-in-out infinite}
    @keyframes bob{0%{transform:translateY(-6px)}50%{transform:translateY(6px)}100%{transform:translateY(-6px)}}

    /* controls */
    .ui{position:absolute;right:18px;top:18px;background:rgba(0,0,0,0.25);backdrop-filter:blur(6px);color:#fff;padding:10px;border-radius:8px;z-index:40}
    .ui button{cursor:pointer;background:transparent;border:1px solid rgba(255,255,255,0.15);color:#fff;padding:6px 10px;border-radius:6px}
    .ui .hint{font-size:12px;opacity:0.9;margin-top:6px}

    /* responsive smaller fish */
    @media (max-width:600px){.fish svg{width:80px}}
  </style>
</head>
<body>
  <div class="aquarium" id="aquarium">
    <!-- seaweed -->
    <div class="seaweed s1"><div class="w"></div></div>
    <div class="seaweed s2"><div class="w"></div></div>
    <div class="seaweed s3"><div class="w"></div></div>

    <!-- dynamically added fish + bubbles go here -->

    <div class="sand"></div>

    <!-- small UI -->
    <div class="ui">
      <button id="addFish">Thêm cá</button>
      <button id="clearFish">Xóa cá</button>
      <div class="hint">Nhấp 'Thêm cá' để spawn, hoặc nhấp vào hồ để spawn nhanh.</div>
    </div>
  </div>

  <template id="fishTemplate">
    <!-- SVG fish: body + tail + eye; color controllable -->
    <div class="fish bob">
      <svg viewBox="0 0 200 100" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
        <defs>
          <filter id="glow"><feGaussianBlur stdDeviation="2.2" result="b"/><feBlend in="SourceGraphic" in2="b"/></filter>
        </defs>
        <g class="fish-shape">
          <ellipse cx="90" cy="50" rx="60" ry="32" fill="#ff9f6b"/>
          <path d="M150 50 q30 -20 40 0 q-10 20 -40 0" fill="#ff7a3d"/>
          <polygon points="25,50 60,65 60,35" fill="#ff7a3d" />
          <circle cx="115" cy="40" r="6" fill="#fff"/>
          <circle cx="116" cy="40" r="2.5" fill="#000"/>
        </g>
      </svg>
    </div>
  </template>

  <script>
    const aquarium = document.getElementById('aquarium');
    const fishT = document.getElementById('fishTemplate');

    // utility random
    function rand(min,max){return Math.random()*(max-min)+min}

    // create a fish with random properties
    function createFish(opts={}){
      const node = fishT.content.firstElementChild.cloneNode(true);
      const svg = node.querySelector('svg');

      // randomize color
      const hue = opts.hue ?? Math.floor(rand(0,360));
      const sat = opts.sat ?? Math.floor(rand(60,85));
      const light = opts.light ?? Math.floor(rand(45,62));
      svg.querySelector('ellipse').setAttribute('fill',`hsl(${hue} ${sat}% ${light}%)`);
      svg.querySelector('path').setAttribute('fill',`hsl(${(hue+20)%360} ${Math.max(sat-6,45)}% ${Math.max(light-12,40)}%)`);
      svg.querySelector('polygon').setAttribute('fill',`hsl(${(hue+10)%360} ${sat}% ${Math.max(light-8,42)}%)`);

      // size
      const scale = opts.scale ?? rand(0.6,1.2);
      svg.style.width = `${120*scale}px`;

      // vertical position
      const y = opts.y ?? rand(-18,18);
      node.style.setProperty('--y', y + 'px');

      // direction and speed
      const dir = opts.dir ?? (Math.random()>0.5? 'right': 'left');
      const duration = opts.duration ?? rand(8,26);

      // flip for correct facing
      if(dir === 'right'){
        node.style.setProperty('--flip', -1);
        node.style.animation = `swimRight ${duration}s linear infinite`;
      } else {
        node.style.setProperty('--flip', 1);
        node.style.animation = `swimLeft ${duration}s linear infinite`;
      }

      // slight bobbing (randomized phase)
      node.classList.add('bob');
      node.style.animationDelay = rand(0,5) + 's';

      aquarium.appendChild(node);
      return node;
    }

    // spawn some initial fish
    for(let i=0;i<6;i++) createFish();

    // create bubbles occasionally
    function bubble(){
      const b = document.createElement('div');
      b.className='bubble';
      const size = Math.round(rand(6,28));
      b.style.width = b.style.height = size + 'px';
      b.style.left = rand(6,92) + '%';
      b.style.bottom = '12vh';
      aquarium.appendChild(b);

      const rise = rand(4,12);
      b.animate([
        {transform:'translateY(0) scale(1)', opacity:0.9},
        {transform:`translateY(-${rise}vh) scale(1.3)`, opacity:0.05}
      ],{duration:rand(3500,9000),easing:'cubic-bezier(.2,.9,.2,1)'}).onfinish = ()=>b.remove();
    }
    setInterval(bubble, 900);

    // UI buttons
    document.getElementById('addFish').addEventListener('click', ()=>createFish());
    document.getElementById('clearFish').addEventListener('click', ()=>{
      document.querySelectorAll('.fish').forEach(f=>f.remove());
    });

    // click on aquarium to spawn fish at click Y
    aquarium.addEventListener('click', (e)=>{
      if(e.target.closest('.ui')) return; // ignore clicks on UI
      const rect = aquarium.getBoundingClientRect();
      const percent = (e.clientY - rect.top) / rect.height; // 0 top -> 1 bottom
      // map percent to y offset in px
      const y = (percent - 0.5) * rect.height * 0.4;
      createFish({y});
    });

    // make aquarium responsive when switching tabs
    window.addEventListener('resize', ()=>{/* no-op for now */});

    // accessibility: keyboard to add fish
    window.addEventListener('keydown', (e)=>{ if(e.key==='f') createFish(); });
  </script>
</body>
</html>
